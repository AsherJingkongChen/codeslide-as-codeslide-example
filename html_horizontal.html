<!DOCTYPE html>
<html class="hljs">
<head>
<meta charset="utf-8">
<meta
  name="description"
  content="CodeSlide makes a slideshow for code snippets">
<meta
  name="viewport"
  content="width=device-width, initial-scale=1">
<link
  href="https://fonts.gstatic.com"
  rel="preconnect" crossorigin>
<style>
pre code.hljs {
  display: block;
  overflow-x: auto;
  padding: 1em;
}
code.hljs {
  padding: 3px 5px;
}
.hljs {
  color: #abb2bf;
  background: #282c34;
}
.hljs-comment,
.hljs-quote {
  color: #5c6370;
  font-style: italic;
}
.hljs-doctag,
.hljs-formula,
.hljs-keyword {
  color: #c678dd;
}
.hljs-deletion,
.hljs-name,
.hljs-section,
.hljs-selector-tag,
.hljs-subst {
  color: #e06c75;
}
.hljs-literal {
  color: #56b6c2;
}
.hljs-addition,
.hljs-attribute,
.hljs-meta .hljs-string,
.hljs-regexp,
.hljs-string {
  color: #98c379;
}
.hljs-attr,
.hljs-number,
.hljs-selector-attr,
.hljs-selector-class,
.hljs-selector-pseudo,
.hljs-template-variable,
.hljs-type,
.hljs-variable {
  color: #d19a66;
}
.hljs-bullet,
.hljs-link,
.hljs-meta,
.hljs-selector-id,
.hljs-symbol,
.hljs-title {
  color: #61aeee;
}
.hljs-built_in,
.hljs-class .hljs-title,
.hljs-title.class_ {
  color: #e6c07b;
}
.hljs-emphasis {
  font-style: italic;
}
.hljs-strong {
  font-weight: 700;
}
.hljs-link {
  text-decoration: underline;
}

/*! CodeSlide slides.horizontal.css */
html, body {
  margin: 0;
  -webkit-print-color-adjust: exact;
  print-color-adjust: exact;
  overflow: hidden;
}
a {
  color: dodgerblue;
}
li {
  margin-top: 0.25em;
}
p:empty {
  display: none;
}
pre {
  white-space: pre-wrap;
  overflow-wrap: break-word;
}
pre > code {
  display: block;
  padding: 1em;
}
.slide {
  min-width: calc(100vw - 4em);
  height: calc(100vh - 2em);
  padding: 1em 2em;
  overflow-y: scroll;
  scroll-snap-align: start;
  scroll-snap-stop: always;
  scrollbar-width: none;
}
.slide::-webkit-scrollbar {
  display: none;
}
@media only screen and (max-width: 768px) {
  .slide {
    height: calc(90% - 2em);
    height: calc(100svh - 2em);
  }
}
#slides {
  display: flex;
  flex-direction: row;
  width: 100vw;
  height: 100vh;
  overflow-x: scroll;
  overscroll-behavior: none;
  scroll-behavior: smooth;
  scroll-snap-type: x mandatory;
}
@media print {
  @page {
    margin: 0;
    size: auto;
  }
  #slides {
    width: auto;
    height: auto;
  }
}

@font-face {
  font-family: 'Noto Sans Mono';
  font-style: normal;
  font-weight: 400;
  font-stretch: normal;
  font-display: swap;
  src: url(https://fonts.gstatic.com/s/notosansmono/v26/BngrUXNETWXI6LwhGYvaxZikqZqK6fBq6kPvUce2oAZcdthSBUsYck4-_FNJ49o.ttf) format('truetype');
}
@font-face {
  font-family: 'Noto Sans Mono';
  font-style: normal;
  font-weight: 700;
  font-stretch: normal;
  font-display: swap;
  src: url(https://fonts.gstatic.com/s/notosansmono/v26/BngrUXNETWXI6LwhGYvaxZikqZqK6fBq6kPvUce2oAZcdthSBUsYck4-_LRO49o.ttf) format('truetype');
}

code {
  font-family: Noto Sans Mono, ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
  font-size: 85%;
}
#slides {
  font-family: system-ui;
  font-size: large;
  font-weight: normal;
  line-height: 1.5;
}
</style>
</head>
<body class="hljs">
<div id="slides">
<div class="slide" id="slide_0">
<h1 id="behind-the-scenes-of-codeslide-cli">Behind the Scenes of CodeSlide CLI</h1>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">code</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;slide&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cli&quot;</span>&gt;</span>
  CodeSlide CLI
<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span>
</code></pre>
</div>
<div class="slide" id="slide_1">
<p><h1 id="codeslide-cli">CodeSlide CLI</h1>
<p><a href="https://www.npmjs.com/package/codeslide-cli?activeTab=readme"><img src="https://img.shields.io/npm/v/codeslide-cli?color=%230647D4&label=npm&style=flat-square" alt=""></a></p>
<h2 id="usage-demo">Usage demo</h2>
<p><img src="https://raw.githubusercontent.com/AsherJingkongChen/codeslide/main/app/cli/docs/assets/cli-usage.gif" alt=""></p>
<p>See also <a href="https://github.com/AsherJingkongChen/codeslide/tree/main/app/cli/examples/"><strong>Example usages</strong></a></p>
<h2 id="installation">Installation</h2>
<ol>
<li>Prepare <code>Node.js</code> runtime and <code>NPM</code> package manager</li>
<li>Run <code>npm install -g codeslide-cli</code> on the command line</li>
</ol>
<h2 id="features">Features</h2>
<ul>
<li>It allows you to easily make awesome slideshows for code snippets on command lines</li>
<li>It is an application of <a href="https://github.com/AsherJingkongChen/codeslide">CodeSlide</a></li>
<li>It is a Node.js Command Line Interface (CLI)</li>
</ul>
<h2 id="documents">Documents</h2>
<ul>
<li>See <a href="https://github.com/AsherJingkongChen/codeslide/blob/main/app/cli/docs/REFERENCE.md">Reference</a> for more information</li>
</ul>
<h2 id="creator">Creator</h2>
<ul>
<li><a href="https://github.com/AsherJingkongChen">AsherJingkongChen</a></li>
</ul>
</p>
</div>
<div class="slide" id="slide_2">
<h1 id="the-general-process">The general process</h1>
<ol>
<li>Build a schema</li>
<li>Render HTML and CSS to slideshow with it</li>
<li>Print the rendered slideshow to the output</li>
</ol>
</div>
<div class="slide" id="slide_3">
<h1 id="manifest"><code>Manifest</code></h1>
<ul>
<li>The main schema</li>
<li>A combination of <a href="#frontmatter"><code>FrontMatter</code></a> and <a href="#slideshow"><code>SlideShow</code></a></li>
<li>An extended <a href="#renderer"><code>Renderer</code></a> schema</li>
<li><code>Manifest.parse</code>: Parse a <a href="#manifest-file">manifest file</a> into a <code>Manifest</code> schema</li>
<li><code>Manifest.render</code>: Render the slideshow</li>
</ul>
<p><pre><code class="language-ts"><span class="hljs-keyword">import</span> matter <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;gray-matter&#x27;</span>;
<span class="hljs-keyword">import</span> { launch } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;puppeteer&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">FrontMatter</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./FrontMatter&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">SlideShow</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./SlideShow&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Renderer</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../../src&#x27;</span>;
<span class="hljs-keyword">import</span> { getContent } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../utils&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">Manifest</span> = <span class="hljs-title class_">FrontMatter</span> &amp; <span class="hljs-title class_">SlideShow</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">namespace</span> <span class="hljs-title class_">Manifest</span> {
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">RenderResult</span> = {
    <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>,
    <span class="hljs-attr">encoding</span>: <span class="hljs-title class_">BufferEncoding</span>,
  };

  <span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> parse = <span class="hljs-keyword">async</span> (
    <span class="hljs-attr">manifest</span>: <span class="hljs-built_in">string</span>
  ): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Manifest</span>&gt; =&gt; {
    manifest = manifest.<span class="hljs-title function_">replace</span>(
      <span class="hljs-regexp">/^[\u200B\u200C\u200D\u200E\u200F\uFEFF]/</span>, <span class="hljs-string">&#x27;&#x27;</span>
    );
    <span class="hljs-keyword">const</span> { content, <span class="hljs-attr">data</span>: { codeslide } } = <span class="hljs-title function_">matter</span>(manifest);
    <span class="hljs-keyword">const</span> fm = <span class="hljs-title class_">FrontMatter</span>.<span class="hljs-title function_">parse</span>(codeslide);
    fm.<span class="hljs-property">styles</span> = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(
      fm.<span class="hljs-property">styles</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">path</span>) =&gt;</span> <span class="hljs-title function_">getContent</span>(path))
    );
    <span class="hljs-keyword">const</span> slides = <span class="hljs-keyword">await</span> <span class="hljs-title class_">SlideShow</span>.<span class="hljs-title function_">parse</span>(content);
    <span class="hljs-keyword">return</span> { ...fm, ...slides };
  };

  <span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> render = <span class="hljs-keyword">async</span> (
    <span class="hljs-attr">manifest</span>: <span class="hljs-title class_">Manifest</span>
  ): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">RenderResult</span>&gt; =&gt; {
    <span class="hljs-keyword">if</span> (manifest.<span class="hljs-property">format</span> === <span class="hljs-string">&#x27;html&#x27;</span>) {
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">data</span>: <span class="hljs-title class_">Renderer</span>.<span class="hljs-title function_">render</span>(manifest),
        <span class="hljs-attr">encoding</span>: <span class="hljs-string">&#x27;utf8&#x27;</span>,
      };
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">const</span> browser = <span class="hljs-keyword">await</span> <span class="hljs-title function_">launch</span>();
      <span class="hljs-keyword">const</span> page = <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">newPage</span>();
      <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">setContent</span>(<span class="hljs-title class_">Renderer</span>.<span class="hljs-title function_">render</span>(manifest));
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">pdf</span>({
        <span class="hljs-attr">printBackground</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">format</span>: manifest.<span class="hljs-property">pageSize</span>,
      });
      <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">close</span>();
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">data</span>: result.<span class="hljs-title function_">toString</span>(<span class="hljs-string">&#x27;base64&#x27;</span>),
        <span class="hljs-attr">encoding</span>: <span class="hljs-string">&#x27;base64&#x27;</span>,
      };
    }
  };  
}
</code></pre></p>
</div>
<div class="slide" id="slide_4">
<h1 id="manifest-file">Manifest file</h1>
<ul>
<li>A markdown document constructed of the Front Matter section and the Slide Show section</li>
<li>The specifications of Manifest file is <a href="https://github.com/AsherJingkongChen/codeslide/blob/main/app/cli/docs/REFERENCE.md#manifest-file-specifications">here</a></li>
</ul>
</div>
<div class="slide" id="slide_5">
<h1 id="frontmatter"><code>FrontMatter</code></h1>
<ul>
<li>The Front Matter section schema</li>
<li>An extended <code>Renderer</code> schema</li>
<li>Parsed from the Front Matter section of <a href="#manifest-file">manifest file</a> (YAML syntax)</li>
</ul>
<p><pre><code class="language-ts"><span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;zod&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Renderer</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../../src&#x27;</span>;
<span class="hljs-keyword">import</span> { version } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../../package.json&#x27;</span>;
<span class="hljs-keyword">import</span> { formatZodError } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../utils&#x27;</span>;
<span class="hljs-keyword">import</span> semver <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;semver-regex&#x27;</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">FrontMatter</span> = z.<span class="hljs-property">infer</span>&lt;<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">FrontMatter</span>.<span class="hljs-property">schema</span>&gt;;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">namespace</span> <span class="hljs-title class_">FrontMatter</span> {
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> parse = (
    fm?: <span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">FrontMatter</span>&gt;
  ): <span class="hljs-function"><span class="hljs-params">FrontMatter</span> =&gt;</span> (
    schema.<span class="hljs-title function_">default</span>({}).<span class="hljs-title function_">parse</span>(fm)
  );

  <span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> schema = z
    .<span class="hljs-title function_">object</span>({
      <span class="hljs-attr">format</span>: z.<span class="hljs-title function_">enum</span>([<span class="hljs-string">&#x27;html&#x27;</span>, <span class="hljs-string">&#x27;pdf&#x27;</span>]).<span class="hljs-title function_">default</span>(<span class="hljs-string">&#x27;html&#x27;</span>),
      <span class="hljs-attr">pageSize</span>: z
        .<span class="hljs-title function_">enum</span>([
          <span class="hljs-string">&#x27;letter&#x27;</span>, <span class="hljs-string">&#x27;legal&#x27;</span>, <span class="hljs-string">&#x27;tabloid&#x27;</span>, <span class="hljs-string">&#x27;ledger&#x27;</span>,
          <span class="hljs-string">&#x27;A0&#x27;</span>, <span class="hljs-string">&#x27;A1&#x27;</span>, <span class="hljs-string">&#x27;A2&#x27;</span>, <span class="hljs-string">&#x27;A3&#x27;</span>, <span class="hljs-string">&#x27;A4&#x27;</span>, <span class="hljs-string">&#x27;A5&#x27;</span>, <span class="hljs-string">&#x27;A6&#x27;</span>
        ])
        .<span class="hljs-title function_">default</span>(<span class="hljs-string">&#x27;A4&#x27;</span>),
      <span class="hljs-attr">version</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">regex</span>(<span class="hljs-title function_">semver</span>()).<span class="hljs-title function_">default</span>(version),
    })
    .<span class="hljs-title function_">and</span>(<span class="hljs-title class_">Renderer</span>.<span class="hljs-property">schema</span>.<span class="hljs-title function_">omit</span>({ <span class="hljs-attr">slides</span>: <span class="hljs-literal">true</span> }))
    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> error = e.<span class="hljs-property">error</span>.<span class="hljs-property">errors</span>[<span class="hljs-number">0</span>];
      error.<span class="hljs-property">path</span>.<span class="hljs-title function_">unshift</span>(<span class="hljs-string">&#x27;codeslide&#x27;</span>);
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`\
Cannot parse the Front Matter section:
\t<span class="hljs-subst">${formatZodError(error)}</span>`</span>
      );
    })
    .<span class="hljs-title function_">transform</span>(<span class="hljs-function">(<span class="hljs-params">fm</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (
        fm.<span class="hljs-property">format</span> === <span class="hljs-string">&#x27;pdf&#x27;</span> &amp;&amp;
        fm.<span class="hljs-property">layout</span> !== <span class="hljs-string">&#x27;vertical&#x27;</span>
      ) {
        fm.<span class="hljs-property">layout</span> = <span class="hljs-string">&#x27;vertical&#x27;</span>;
      }
      <span class="hljs-keyword">return</span> fm;
    });
}
</code></pre></p>
</div>
<div class="slide" id="slide_6">
<h1 id="slideshow"><code>SlideShow</code></h1>
<ul>
<li>The Slide Show section schema</li>
<li>An labeled object whose type is <code>{ slides: string[] }</code></li>
<li>Parsed from the Slide Show section of <a href="#manifest-file">manifest file</a> (Markdown syntax)</li>
<li>Each slide is splitted by a horizontal line</li>
<li>Has special rules for rendering embedding code snippets and slides</li>
</ul>
<p><pre><code class="language-ts"><span class="hljs-keyword">import</span> hljs, { <span class="hljs-title class_">HighlightResult</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;highlight.js&#x27;</span>;
<span class="hljs-keyword">import</span> { marked } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;marked&#x27;</span>;
<span class="hljs-keyword">import</span> { getContent } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../utils&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">SlideShow</span> = { <span class="hljs-attr">slides</span>: <span class="hljs-built_in">string</span>[] };

<span class="hljs-keyword">export</span> <span class="hljs-keyword">namespace</span> <span class="hljs-title class_">SlideShow</span> {
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> parse = <span class="hljs-keyword">async</span> (
    <span class="hljs-attr">markdown</span>: <span class="hljs-built_in">string</span>
  ): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">SlideShow</span>&gt; =&gt; {
    <span class="hljs-keyword">const</span> html = <span class="hljs-keyword">await</span> <span class="hljs-title function_">_parseMarkdown</span>(markdown);
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">slides</span>: html.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;&lt;hr&gt;&#x27;</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> s.<span class="hljs-title function_">trim</span>()) };
  };
}

<span class="hljs-keyword">const</span> _parseMarkdown = (
  <span class="hljs-attr">markdown</span>: <span class="hljs-built_in">string</span>
): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; =&gt; (
  marked.<span class="hljs-title function_">parse</span>(markdown, {
    <span class="hljs-attr">async</span>: <span class="hljs-literal">true</span>,
    highlight,
    walkTokens,
  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: <span class="hljs-built_in">Error</span></span>) =&gt;</span> {
    err.<span class="hljs-property">message</span> = err.<span class="hljs-property">message</span>.<span class="hljs-title function_">replace</span>(
      <span class="hljs-string">&#x27;\nPlease report this to https://github.com/markedjs/marked.&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>
    );
    err.<span class="hljs-property">message</span> = <span class="hljs-string">`Cannot parse the Slide Show section:\n\t<span class="hljs-subst">${err.message}</span>`</span>;
    <span class="hljs-keyword">throw</span> err;
  })
);

<span class="hljs-keyword">const</span> highlight = (<span class="hljs-attr">code</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">language</span>: <span class="hljs-built_in">string</span>): <span class="hljs-function"><span class="hljs-params">string</span> =&gt;</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">return</span> hljs.<span class="hljs-title function_">highlight</span>(code, { language }).<span class="hljs-property">value</span>;
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-keyword">const</span> err = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">Error</span>;
    err.<span class="hljs-property">message</span> =
      <span class="hljs-string">`Cannot parse the code &quot;<span class="hljs-subst">${
        code.substring(<span class="hljs-number">0</span>, <span class="hljs-number">30</span>).split(<span class="hljs-string">&#x27;\n&#x27;</span>)[<span class="hljs-number">0</span>]
      }</span> ...&quot;:\n\t<span class="hljs-subst">${err.message}</span>`</span>;
    <span class="hljs-keyword">throw</span> e;
  }
};

<span class="hljs-keyword">const</span> walkTokens = <span class="hljs-keyword">async</span> (
  <span class="hljs-attr">token</span>: marked.<span class="hljs-property">Token</span>
): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; =&gt; {
  <span class="hljs-keyword">if</span> (token.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;link&#x27;</span>) {
    <span class="hljs-keyword">const</span> { href, text } = token;
    <span class="hljs-keyword">if</span> (! text.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&#x27;:&#x27;</span>)) {
      <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">const</span> [prefix, suffix] = &lt;[<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span>]&gt;
      text.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;.&#x27;</span>);
    token = <span class="hljs-title function_">_toHTMLToken</span>(token);
    <span class="hljs-keyword">if</span> (prefix === <span class="hljs-string">&#x27;:slide&#x27;</span>) {
      <span class="hljs-keyword">const</span> slide = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getContent</span>(href);
      token.<span class="hljs-property">text</span> = <span class="hljs-keyword">await</span> <span class="hljs-title function_">_parseMarkdown</span>(slide);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (prefix === <span class="hljs-string">&#x27;:code&#x27;</span>) {
      <span class="hljs-keyword">const</span> code = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getContent</span>(href);
      <span class="hljs-keyword">let</span> <span class="hljs-attr">result</span>: <span class="hljs-title class_">HighlightResult</span> | <span class="hljs-literal">undefined</span>;
      <span class="hljs-keyword">try</span> {
        result = hljs.<span class="hljs-title function_">highlight</span>(code, {
          <span class="hljs-attr">language</span>: suffix ?? <span class="hljs-string">&#x27;plaintext&#x27;</span>
        });
      } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-keyword">const</span> err = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">Error</span>;
        err.<span class="hljs-property">message</span> = <span class="hljs-string">`\
Cannot parse the code at <span class="hljs-subst">${href}</span>:
\t<span class="hljs-subst">${err.message}</span>`</span>;
        <span class="hljs-keyword">throw</span> e;
      }
      token.<span class="hljs-property">text</span> = <span class="hljs-string">`\
&lt;pre&gt;&lt;code<span class="hljs-subst">${
  result.language ?
    <span class="hljs-string">` class=&quot;language-<span class="hljs-subst">${result.language}</span>&quot;`</span> : <span class="hljs-string">&#x27;&#x27;</span>
}</span>&gt;<span class="hljs-subst">${
  result.value
}</span>&lt;/code&gt;&lt;/pre&gt;`</span>;
    }
  }
};

<span class="hljs-keyword">const</span> _toHTMLToken = (
  <span class="hljs-attr">token</span>: marked.<span class="hljs-property">Token</span>
): marked.<span class="hljs-property">Tokens</span>.<span class="hljs-property">HTML</span> =&gt; {
  <span class="hljs-keyword">const</span> { raw } = token;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> p <span class="hljs-keyword">in</span> token) {
    <span class="hljs-keyword">if</span> (token.<span class="hljs-title function_">hasOwnProperty</span>(p)){
      <span class="hljs-keyword">delete</span> token[p <span class="hljs-keyword">as</span> keyof marked.<span class="hljs-property">Token</span>];
    }
  }
  token = token <span class="hljs-keyword">as</span> marked.<span class="hljs-property">Token</span>;
  token.<span class="hljs-property">type</span> = <span class="hljs-string">&#x27;html&#x27;</span>;
  token.<span class="hljs-property">raw</span> = raw;
  token = token <span class="hljs-keyword">as</span> marked.<span class="hljs-property">Tokens</span>.<span class="hljs-property">HTML</span>;
  token.<span class="hljs-property">pre</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">return</span> token;
};
</code></pre></p>
</div>
<div class="slide" id="slide_7">
<h1 id="renderer"><code>Renderer</code></h1>
<ul>
<li>The slideshow renderer schema </li>
<li>Depends on <a href="https://github.com/eta-dev/eta">Eta</a> to render <a href="#html-template">HTML template</a></li>
<li><code>Renderer.parse</code>: Parse an object into a <code>Renderer</code> schema</li>
<li><code>Renderer.render</code>: Render the slideshow to HTML text</li>
</ul>
<h2 id="note">Note</h2>
<ul>
<li><code>Renderer</code> is the root schema of <a href="#manifest"><code>Manifest</code></a>. That is, <a href="#manifest"><code>Manifest</code></a> is an extended <code>Renderer</code>.</li>
</ul>
<p><pre><code class="language-ts"><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;*.css&#x27;</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-attr">_</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> _;
}
<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;*.html&#x27;</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-attr">_</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> _;
}
</code></pre>
<pre><code class="language-ts"><span class="hljs-keyword">import</span> <span class="hljs-title class_">GithubDarkDimmed</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./github-dark-dimmed.css&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">HorizontalStylesheet</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./slides.horizontal.css&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">VerticalStylesheet</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./slides.vertical.css&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">HTMLTemplate</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./slides.html&#x27;</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">Stylesheets</span> = {
  <span class="hljs-attr">horizontal</span>: <span class="hljs-title class_">HorizontalStylesheet</span>,
  <span class="hljs-attr">vertical</span>: <span class="hljs-title class_">VerticalStylesheet</span>,
  <span class="hljs-attr">highlight</span>: <span class="hljs-title class_">GithubDarkDimmed</span>,
};

<span class="hljs-keyword">export</span> { <span class="hljs-title class_">HTMLTemplate</span>, <span class="hljs-title class_">Stylesheets</span> };
</code></pre>
<pre><code class="language-ts"><span class="hljs-keyword">import</span> { render <span class="hljs-keyword">as</span> renderEta } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;eta&#x27;</span>;
<span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;zod&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Stylesheets</span>, <span class="hljs-title class_">HTMLTemplate</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../assets&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">Renderer</span> = z.<span class="hljs-property">infer</span>&lt;<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Renderer</span>.<span class="hljs-property">schema</span>&gt;;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">namespace</span> <span class="hljs-title class_">Renderer</span> {
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> parse = (
    renderer?: <span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">Renderer</span>&gt;
  ): <span class="hljs-function"><span class="hljs-params">Renderer</span> =&gt;</span> (
    schema.<span class="hljs-title function_">default</span>({}).<span class="hljs-title function_">parse</span>(renderer)
  );

  <span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> render = (
    <span class="hljs-attr">renderer</span>: <span class="hljs-title class_">Renderer</span>
  ): <span class="hljs-function"><span class="hljs-params">string</span> =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">renderEta</span>(<span class="hljs-title class_">HTMLTemplate</span>, {
      <span class="hljs-attr">layout</span>: renderer.<span class="hljs-property">layout</span>,
      <span class="hljs-attr">slides</span>: renderer.<span class="hljs-property">slides</span>,
      <span class="hljs-attr">style</span>: <span class="hljs-string">`\
&lt;style&gt;
<span class="hljs-subst">${[
  Stylesheets[<span class="hljs-string">&#x27;highlight&#x27;</span>],
  Stylesheets[renderer.layout],
  ...renderer.styles,
<span class="hljs-string">`code {
  font-family: <span class="hljs-subst">${renderer.fontFamily}</span>;
  font-size: 85%;
}`</span>,
<span class="hljs-string">`#slides {
  font-family: system-ui;
  font-size: <span class="hljs-subst">${renderer.fontSize}</span>;
  font-weight: <span class="hljs-subst">${renderer.fontWeight}</span>;
  line-height: 1.5;
}`</span>,
].join(<span class="hljs-string">&#x27;\n&#x27;</span>)}</span>
&lt;/style&gt;`</span>,
    },
    {
      <span class="hljs-attr">autoTrim</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">tags</span>: [<span class="hljs-string">&#x27;{%&#x27;</span>, <span class="hljs-string">&#x27;%}&#x27;</span>]
    });
  };

  <span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> schema = z
    .<span class="hljs-title function_">object</span>({
      <span class="hljs-attr">fontFamily</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">optional</span>().<span class="hljs-title function_">transform</span>(<span class="hljs-function">(<span class="hljs-params">arg</span>) =&gt;</span> <span class="hljs-string">`\
<span class="hljs-subst">${arg ? <span class="hljs-string">`<span class="hljs-subst">${arg}</span>, `</span> : <span class="hljs-string">&#x27;&#x27;</span>}</span>ui-monospace, SFMono-Regular, \
SF Mono, Menlo, Consolas, Liberation Mono, monospace`</span>
      ),
      <span class="hljs-attr">fontSize</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">default</span>(<span class="hljs-string">&#x27;large&#x27;</span>),
      <span class="hljs-attr">fontWeight</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">default</span>(<span class="hljs-string">&#x27;normal&#x27;</span>),
      <span class="hljs-attr">layout</span>: z.<span class="hljs-title function_">enum</span>([<span class="hljs-string">&#x27;horizontal&#x27;</span>, <span class="hljs-string">&#x27;vertical&#x27;</span>]).<span class="hljs-title function_">default</span>(<span class="hljs-string">&#x27;horizontal&#x27;</span>),
      <span class="hljs-attr">slides</span>: z.<span class="hljs-title function_">array</span>(z.<span class="hljs-title function_">string</span>()).<span class="hljs-title function_">default</span>([]),
      <span class="hljs-attr">styles</span>: z.<span class="hljs-title function_">array</span>(z.<span class="hljs-title function_">string</span>()).<span class="hljs-title function_">default</span>([]),
    });
}
</code></pre></p>
</div>
<div class="slide" id="slide_8">
<h1 id="html-template">HTML template</h1>
<p>{% and %} are interpolation characters</p>
<p><pre><code class="language-html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;hljs&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">meta</span>
  <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;description&quot;</span>
  <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;CodeSlide makes a slideshow for code snippets&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">meta</span>
  <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span>
  <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">link</span>
  <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://fonts.gstatic.com&quot;</span>
  <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;preconnect&quot;</span> <span class="hljs-attr">crossorigin</span>&gt;</span>
{%~ it.style %}
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;hljs&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;slides&quot;</span>&gt;</span>
{%_ for (const [index, slide] of it.slides.entries()) { %}
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;slide&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;slide_{%~ index %}&quot;</span>&gt;</span>
  {%_ if (index !== 0 &amp;&amp; it.layout === &#x27;vertical&#x27;) { %}
<span class="hljs-tag">&lt;<span class="hljs-name">hr</span>&gt;</span>
  {%_ } %}
{%~ slide %}
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
{%_ } %}
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre></p>
</div>
<div class="slide" id="slide_9">
<h1 id="css-horizontal-layout">CSS (Horizontal layout)</h1>
<p><pre><code class="language-css"><span class="hljs-comment">/*! CodeSlide slides.horizontal.css */</span>
<span class="hljs-selector-tag">html</span>, <span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  -webkit-print-<span class="hljs-attribute">color</span>-adjust: exact;
  print-<span class="hljs-attribute">color</span>-adjust: exact;
  <span class="hljs-attribute">overflow</span>: hidden;
}
<span class="hljs-selector-tag">a</span> {
  <span class="hljs-attribute">color</span>: dodgerblue;
}
<span class="hljs-selector-tag">li</span> {
  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">0.25em</span>;
}
<span class="hljs-selector-tag">p</span><span class="hljs-selector-pseudo">:empty</span> {
  <span class="hljs-attribute">display</span>: none;
}
pre {
  <span class="hljs-attribute">white-space</span>: pre-wrap;
  <span class="hljs-attribute">overflow-wrap</span>: break-word;
}
pre &gt; <span class="hljs-selector-tag">code</span> {
  <span class="hljs-attribute">display</span>: block;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">1em</span>;
}
<span class="hljs-selector-class">.slide</span> {
  <span class="hljs-attribute">min-width</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">100vw</span> - <span class="hljs-number">4em</span>);
  <span class="hljs-attribute">height</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">100vh</span> - <span class="hljs-number">2em</span>);
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">1em</span> <span class="hljs-number">2em</span>;
  <span class="hljs-attribute">overflow-y</span>: scroll;
  <span class="hljs-attribute">scroll-snap-align</span>: start;
  <span class="hljs-attribute">scroll-snap-stop</span>: always;
  <span class="hljs-attribute">scrollbar-width</span>: none;
}
<span class="hljs-selector-class">.slide</span>::-webkit-scrollbar {
  <span class="hljs-attribute">display</span>: none;
}
<span class="hljs-keyword">@media</span> <span class="hljs-keyword">only</span> screen <span class="hljs-keyword">and</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">768px</span>) {
  <span class="hljs-selector-class">.slide</span> {
    <span class="hljs-attribute">height</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">90%</span> - <span class="hljs-number">2em</span>);
    <span class="hljs-attribute">height</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">100s</span>vh - <span class="hljs-number">2em</span>);
  }
}
<span class="hljs-selector-id">#slides</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">flex-direction</span>: row;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100vw</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
  <span class="hljs-attribute">overflow-x</span>: scroll;
  overscroll-behavior: none;
  scroll-behavior: smooth;
  <span class="hljs-attribute">scroll-snap-type</span>: x mandatory;
}
<span class="hljs-keyword">@media</span> print {
  <span class="hljs-keyword">@page</span> {
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
    size: auto;
  }
  <span class="hljs-selector-id">#slides</span> {
    <span class="hljs-attribute">width</span>: auto;
    <span class="hljs-attribute">height</span>: auto;
  }
}
</code></pre></p>
</div>
<div class="slide" id="slide_10">
<h1 id="css-vertical-layout">CSS (Vertical layout)</h1>
<p><pre><code class="language-css"><span class="hljs-comment">/*! CodeSlide slides.vertical.css */</span>
<span class="hljs-selector-tag">html</span>, <span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  -webkit-print-<span class="hljs-attribute">color</span>-adjust: exact;
  print-<span class="hljs-attribute">color</span>-adjust: exact;
  <span class="hljs-attribute">overflow</span>: hidden;
}
<span class="hljs-selector-tag">a</span> {
  <span class="hljs-attribute">color</span>: dodgerblue;
}
<span class="hljs-selector-tag">li</span> {
  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">0.25em</span>;
}
<span class="hljs-selector-tag">p</span><span class="hljs-selector-pseudo">:empty</span> {
  <span class="hljs-attribute">display</span>: none;
}
pre {
  <span class="hljs-attribute">white-space</span>: pre-wrap;
  <span class="hljs-attribute">overflow-wrap</span>: break-word;
}
pre &gt; <span class="hljs-selector-tag">code</span> {
  <span class="hljs-attribute">display</span>: block;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">1em</span>;
}
<span class="hljs-selector-class">.slide</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">1em</span> <span class="hljs-number">2em</span>;
}
<span class="hljs-selector-id">#slides</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">flex-direction</span>: column;
  <span class="hljs-attribute">position</span>: absolute; <span class="hljs-comment">/* fix height on mobile */</span>
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100vw</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
  <span class="hljs-attribute">overflow-y</span>: scroll;
  overscroll-behavior: none;
  scroll-behavior: smooth;
}
<span class="hljs-keyword">@media</span> print {
  <span class="hljs-keyword">@page</span> {
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
    size: auto;
  }
  <span class="hljs-selector-id">#slides</span> {
    <span class="hljs-attribute">width</span>: auto;
    <span class="hljs-attribute">height</span>: auto;
  }
}
</code></pre></p>
</div>
<div class="slide" id="slide_11">
<h1 id="the-entry-point">The entry point</h1>
<p><pre><code class="language-ts"><span class="hljs-keyword">import</span> { program } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;commander&#x27;</span>;
<span class="hljs-keyword">import</span> { readFileSync, writeFileSync } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;fs&#x27;</span>;
<span class="hljs-keyword">import</span> { stdin, stdout } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;process&#x27;</span>;
<span class="hljs-keyword">import</span> { version, homepage, name } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../package.json&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CLIOptions</span>, <span class="hljs-title class_">Manifest</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./schemas&#x27;</span>;

program
  .<span class="hljs-title function_">name</span>(name)
  .<span class="hljs-title function_">description</span>(<span class="hljs-string">`\
Example: <span class="hljs-subst">${name}</span> -m ./manifest.md -o ./output.html

Make a slideshow (HTML/PDF file) for code snippets
with a manifest (Markdown file).

Go to home page for more information: <span class="hljs-subst">${homepage}</span>`</span>
  )
  .<span class="hljs-title function_">version</span>(version, <span class="hljs-string">&#x27;-v, --version&#x27;</span>, <span class="hljs-string">`\
Check the version number.`</span>
  )
  .<span class="hljs-title function_">helpOption</span>(<span class="hljs-string">&#x27;-h, --help&#x27;</span>, <span class="hljs-string">`\
Check all options and their description.`</span>
  )
  .<span class="hljs-title function_">option</span>(<span class="hljs-string">&#x27;-o, --output [local_path]&#x27;</span>, <span class="hljs-string">`\
The &quot;output file path&quot; of slideshow.
By default it writes the output to stdout.`</span>
  )
  .<span class="hljs-title function_">option</span>(<span class="hljs-string">&#x27;-m, --manifest [local_path]&#x27;</span>, <span class="hljs-string">`\
The &quot;manifest file path&quot; of slideshow.
By default it reads manifest from stdin.`</span>
  )
  .<span class="hljs-title function_">action</span>(<span class="hljs-keyword">async</span> (<span class="hljs-attr">options</span>: <span class="hljs-title class_">CLIOptions</span>) =&gt; {
    <span class="hljs-keyword">let</span> { output, manifest } = <span class="hljs-title class_">CLIOptions</span>.<span class="hljs-title function_">parse</span>(options);
    <span class="hljs-keyword">const</span> file = output ?? stdout.<span class="hljs-property">fd</span>;
    <span class="hljs-keyword">if</span> (manifest) {
      <span class="hljs-keyword">const</span> _manifest = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Manifest</span>.<span class="hljs-title function_">parse</span>(
        <span class="hljs-title function_">readFileSync</span>(manifest, <span class="hljs-string">&#x27;utf8&#x27;</span>)
      );
      <span class="hljs-keyword">const</span> { data, encoding } = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Manifest</span>.<span class="hljs-title function_">render</span>(
        _manifest
      );
      <span class="hljs-title function_">writeFileSync</span>(file, data, encoding);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">let</span> buffer = <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">alloc</span>(<span class="hljs-number">0</span>);
      stdin
        .<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">d</span>) =&gt;</span> {
          buffer = <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">concat</span>([buffer, d]);
        })
        .<span class="hljs-title function_">once</span>(<span class="hljs-string">&#x27;end&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
          <span class="hljs-keyword">const</span> _manifest = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Manifest</span>.<span class="hljs-title function_">parse</span>(
            buffer.<span class="hljs-title function_">toString</span>(<span class="hljs-string">&#x27;utf8&#x27;</span>)
          );
          <span class="hljs-keyword">const</span> { data, encoding } = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Manifest</span>.<span class="hljs-title function_">render</span>(
            _manifest
          );
          <span class="hljs-title function_">writeFileSync</span>(file, data, encoding);
        });
    }
  })
  .<span class="hljs-title function_">parseAsync</span>()
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> { <span class="hljs-keyword">throw</span> err; });
</code></pre></p>
<h2 id="clioptions"><code>CLIOptions</code></h2>
<ul>
<li>The CLI options schema</li>
<li><code>-m, --manifest</code>: Manifest file path</li>
<li><code>-o, --output</code>: Output file path</li>
</ul>
<p><pre><code class="language-ts"><span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;zod&#x27;</span>;
<span class="hljs-keyword">import</span> { formatZodError } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../utils&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">CLIOptions</span> = z.<span class="hljs-property">infer</span>&lt;<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">CLIOptions</span>.<span class="hljs-property">schema</span>&gt;;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">namespace</span> <span class="hljs-title class_">CLIOptions</span> {
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> parse = (
    options?: <span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">CLIOptions</span>&gt;
  ): <span class="hljs-function"><span class="hljs-params">CLIOptions</span> =&gt;</span> (
    schema.<span class="hljs-title function_">default</span>({}).<span class="hljs-title function_">parse</span>(options)
  );

  <span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> schema = z
    .<span class="hljs-title function_">strictObject</span>({
      <span class="hljs-attr">manifest</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">optional</span>(),
      <span class="hljs-attr">output</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">optional</span>(),
    })
    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`\
Cannot parse the CLI options:
\t<span class="hljs-subst">${formatZodError(e.error.errors[<span class="hljs-number">0</span>])}</span>`</span>
      );
    });
}
</code></pre></p>
</div>
<div class="slide" id="slide_12">
<h1 id="miscellaneous">Miscellaneous</h1>
<ul>
<li>Because <a href="https://github.com/node-fetch/node-fetch">Node Fetch</a> does not handle <code>file:</code> URI scheme, CodeSlide CLI implements it with <code>fs.readFileSync</code>:
<pre><code class="language-ts"><span class="hljs-keyword">import</span> fetch <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;node-fetch&#x27;</span>;
<span class="hljs-keyword">import</span> statuses <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;statuses&#x27;</span>;
<span class="hljs-keyword">import</span> { readFileSync } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;fs&#x27;</span>;
<span class="hljs-keyword">import</span> { pathToFileURL } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;url&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getContent = <span class="hljs-keyword">async</span> (
  <span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span> | <span class="hljs-variable constant_">URL</span>,
): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; =&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> path === <span class="hljs-string">&#x27;string&#x27;</span>) {
    <span class="hljs-keyword">try</span> {
      path = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(path);
    } <span class="hljs-keyword">catch</span> (err) {
      path = <span class="hljs-title function_">pathToFileURL</span>(path.<span class="hljs-title function_">toString</span>());
    }
  }
  <span class="hljs-keyword">if</span> (path.<span class="hljs-property">protocol</span> === <span class="hljs-string">&#x27;file:&#x27;</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">readFileSync</span>(path, <span class="hljs-string">&#x27;utf8&#x27;</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(path);
    <span class="hljs-keyword">if</span> (res.<span class="hljs-property">ok</span>) { <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">text</span>(); }
    <span class="hljs-keyword">const</span> { status, url } = res;
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(
      <span class="hljs-string">`Cannot GET <span class="hljs-subst">${url}</span> due to the error <span class="hljs-subst">${status}</span> (<span class="hljs-subst">${statuses(status)}</span>)`</span>
    );
  }
};
</code></pre></li>
</ul>
</div>
<div class="slide" id="slide_13">
<h1 id="thanks-for-your-watching">Thanks for your watching!</h1>
<ul>
<li>The repository of this example is <a href="https://github.com/AsherJingkongChen/codeslide-cli-as-codeslide-cli-example.git">here</a></li>
<li>See other CodeSlide CLI examples <a href="https://github.com/AsherJingkongChen/codeslide/tree/main/app/cli/examples">here</a></li>
<li>See the installation guide of CodeSlide CLI <a href="https://github.com/AsherJingkongChen/codeslide/blob/main/app/cli/README.md#installation">here</a></li>
</ul>
</div>
</div>
</body>
</html>
